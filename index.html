<html>
  <head>
    <title>SamBamViz VIZualizer</title>
    <style>
      body {
        font-family: 'Helvetica', 'Arial', sans-serif;
        color: #444444;
        background-color: hsl(0, 0%, 98%);
      }

      #layout {
        display: flex;
        width: 100%;
        height: 100%;
      }

      #options {
        height: 100%;
        width: 20%;
        display: flex;
        flex-direction: row;
        align-items: center;
        padding-left: 2vw;
        background-color: #eee;
      }

      #graph {
        height: 100%;
        width: 80%;
        display: flex;
        flex-direction: row;
        align-items: center;
        padding: 0vw 3vw;
      }

      #view {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        padding: 0vw 3vw;
      }
      .color-picker {
        display: flex;
        justify-content: space-between;
      }
    </style>
  </head>
  <body>
    <div id="layout">
      <div id="options">
        <div>
          <h3>File Upload</h3>
          <label>Upload SamBamViz File:</label>
          <input type="file" id="sambamviz-upload" />
          <h3>Color Picker</h3>
          <div class="color-picker">
            <label>A</label>
            <input type="color" value="#65F73E" />
          </div>
          <div class="color-picker">
            <label>C</label>
            <input type="color" value="#FFB340" />
          </div>
          <div class="color-picker">
            <label>G</label>
            <input type="color" value="#EB413C" />
          </div>
          <div class="color-picker">
            <label>T</label>
            <input type="color" value="#3C89EE" />
          </div>
          <div class="color-picker">
            <label>Other</label>
            <input type="color" value="#000000" />
          </div>
          <h3>Y-Axis Options</h3>
          <form>
            <input type="radio" id="count-option" name="yaxis" checked="true" />
            <label for="count-option">Count (Linear Scale)</label>
            <br />
            <input type="radio" id="log-option" name="yaxis" />
            <label for="log-option">Count (Log Scale)</label>
            <br />
            <input type="radio" id="proportion-option" name="yaxis" />
            <label for="proportion-option">Proportion</label>
          </form>
          <h3>Range of Data</h3>
          <div id="range-selector">
            <span>Lower:</span>
            <input type="number" id="lower-bound" min="0" max="0" />
            <br />
            <span>Upper:</span>
            <input type="number" id="upper-bound" min="0" max="0" />
          </div>
          <br />
          <button id="loadGraph">Load SamBamViz</button>
        </div>
      </div>
      <div id="graph">
        <div id="view"></div>
      </div>
    </div>

    <script src="init.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <script src="tsv-loader-vega.js"></script>
    <script src="line-graph.js"></script>
    <script src="bar-chart.js"></script>

    <script type="text/javascript">
      document
        .getElementById('sambamviz-upload')
        .addEventListener('change', (e) => {
          processFiles();
        });

      async function processFiles() {
        try {
          const file = document.getElementById('sambamviz-upload').files[0];
          await processSamBamViz(file);
          await tsvToArr(tsvString);
        } catch (error) {
          console.log(error);
        }
      }

      function processSamBamViz(file) {
        return new Promise((resolve, reject) => {
          let reader = new FileReader();

          reader.onload = () => {
            tsvString = reader.result;
            resolve('done');
          };

          reader.readAsText(file);
        });
      }

      // document.getElementById('range-option').addEventListener('click', (e) => {
      //   let rangeSelector = document.getElementById('range-selector');

      //   if (document.getElementById('limit-option').checked) {
      //     document.getElementById('lower-bound').value = BOUNDS.low;
      //     document.getElementById('upper-bound').value = BOUNDS.high;
      //     document.getElementById('lower-bound').max = BOUNDS.high;
      //     document.getElementById('upper-bound').max = BOUNDS.high;
      //   } else {
      //     rangeSelector.style.display = 'none';
      //   }
      // });

      document.getElementById('loadGraph').addEventListener('click', (e) => {
        let yAxisOption = COUNT;
        // let graphTypeOption = BARS;

        let lowerDataBound = BOUNDS.low;
        let upperDataBound = BOUNDS.high;

        if (document.getElementById('count-option').checked) {
          yAxisOption = COUNT;
        } else if (document.getElementById('log-option').checked) {
          yAxisOption = LOG;
        } else if (document.getElementById('proportion-option').checked) {
          yAxisOption = PROPORTION;
        }

        // if (document.getElementById("curves-option").checked) {
        //   graphTypeOption = CURVES;
        // }
        // if (document.getElementById('bars-option').checked) {
        //   graphTypeOption = BARS;
        //   DATA_PER_POS = 5;
        // }

        // if (document.getElementById('limit-option').checked) {
        lowerDataBound = parseInt(document.getElementById('lower-bound').value);
        upperDataBound =
          parseInt(document.getElementById('upper-bound').value) + 1;
        // }

        vega.scheme('strands', [
          '#65F73E',
          '#FFB340',
          '#EB413C',
          '#3C89EE',
          '#000000'
        ]);

        if (yAxisOption == COUNT) {
          loadBarGraph(
            tsvDataCount.slice(
              lowerDataBound * DATA_PER_POS,
              upperDataBound * DATA_PER_POS
            ),
            yAxisOption
          );
        } else if (yAxisOption == LOG) {
          loadBarGraph(
            tsvDataCount.slice(
              lowerDataBound * DATA_PER_POS,
              upperDataBound * DATA_PER_POS
            ),
            yAxisOption
          );
        } else if (yAxisOption == PROPORTION) {
          loadBarGraph(
            tsvDataProp.slice(
              lowerDataBound * DATA_PER_POS,
              upperDataBound * DATA_PER_POS
            ),
            yAxisOption
          );
        }
      });
    </script>
  </body>
</html>
